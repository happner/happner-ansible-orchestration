
- name: Gather all hosts info
  hosts: all  # this ensures that the playbook is run against ALL hosts before moving to the next playbook
  vars:
    - parent_dir: "{{ lookup('pipe','cd ../ && pwd') | string }}" # dynamically find the parent directory

- name: Create temp file for managing host number
  tasks:
    - name: Create localhost tmp file
      file: path={{ item.path }} state={{ item.state }}
      with_items:
       - { path: '/tmp/host_num', state: 'absent' }
       - { path: '/tmp/host_num', state: 'touch' }

- name: Managing tmp files
  lineinfile: dest=/tmp/host_num line='0'

