#
# SEE:
# https://fangpenlin.com/posts/2014/08/11/building-docker-image-with-ansible/
# http://docs.ansible.com/ansible/docker_module.html
# https://github.com/ansible/ansible/blob/devel/docsite/rst/guide_docker.rst

---
- name: Build happn-cluster app image
  hosts: all
  become: sudo
  vars:
    - happn_cluster_version: "1.0.0"
    - happn_cluster_iteration: 1
    - mongo_url: "mongodb://{{inventory_mongo_ip}}:27017/happn-cluster-test"
    - mongo_collection: "happn_cluster_test"
    - parent_dir: "{{ lookup('pipe','cd ../ && pwd') | string }}" # dynamically find the parent directory
  roles:
    - role: "{{ parent_dir }}/roles/cluster_image_build"

